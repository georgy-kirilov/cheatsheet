FROM mcr.microsoft.com/dotnet/sdk:7.0 AS restore
WORKDIR /src
COPY . .
RUN dotnet restore

FROM restore AS development
WORKDIR /src

EXPOSE 80

RUN dotnet tool install --global dotnet-ef
ENV PATH="${PATH}:/root/.dotnet/tools"

ENV ASPNETCORE_URLS=http://+:80
ENV DOTNET_USE_POLLING_FILE_WATCHER=1

WORKDIR /src/Api

ENTRYPOINT ["dotnet", "watch", "run", "--no-restore"]
